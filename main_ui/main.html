<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=overlays-content">
<meta name="apple-mobile-web-app-capable" content="yes"> 
<script src="base_utils.js"></script>
<script src="ColorPicker.js"></script>
<script src="pixel_draw.js"></script>
<script src="asm_gfx.js"></script>
<script src="clock.js"></script>
<script>

const PX_WIDTH = 64
const PX_HEIGHT = 32



function page_onload()
{
    //draw_pixel_onload(body, PX_WIDTH, PX_HEIGHT)
}

let ws_ref = null

function ws_connect()
{
    let url = ""
    if (window.location.protocol == "https:")
        url = "wss://"
    else
        url = "ws://"
    url += window.location.host
    if (window.location.port.length > 0)
        url += ":" + window.location.port
    url += "/ws"
    console.log("ws url: ", url)

    //url = "ws://localhost"

    const ws = new WebSocket(url) //, "cmdss")
    ws_ref = ws
    ws.addEventListener("open", (e)=>{
        //socket.send("Hello Server!")
        console.log("WS connected")
    })

    ws.addEventListener("message", (e)=>{
        console.log("WS mesg:", e.data)
    })

    ws.addEventListener("error", (e)=>{
        console.log("WS error:", e, " b ", JSON.stringify(e), " c ", ws.readyState, " d ", JSON.stringify(ws))
    })
    ws.addEventListener("close", (e)=>{
        console.log("WS close:", e, " a ", e.code, " b ", JSON.stringify(e))
    })

    const send = (cmd)=>{
        try {
            ws.send(cmd)
        }
        catch(e) {
            console.log(e)
        }
    }

    return { send:send }
}

function rt_start()
{
    const ws = ws_connect()

    download("/pref?t=" + new Date().getTime(), (resText)=>{
        const prefJson = JSON.parse(resText)

        clock_create(body, prefJson, ws)
    })
    
}

Module.onRuntimeInitialized = rt_start

</script>
<link rel="stylesheet" type="text/css" href="pixel_draw.css">

</head>
<body id="body" onload="page_onload()"></body>

</html>